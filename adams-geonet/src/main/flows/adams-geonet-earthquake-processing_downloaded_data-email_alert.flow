# Project: adams
# Date: 2014-02-21 00:27:35
# User: fracpete
#
adams.flow.control.Flow
	-annotation
	Local time: 2012-02-07 13:23\nRegion: Canterbury\nRichter Magnitude: 3.0\nhttp://www.geonet.org.nz/earthquake/quakes/3654793g.html
	-actor
		adams.flow.standalone.CallableActors
			-actor
				adams.flow.sink.SequencePlotter
					-writer
						adams.gui.print.NullWriter
					-paintlet
						adams.gui.visualization.sequence.PaintletWithFixedYRange
							-min-y
							-50000.0
							-max-y
							50000.0
							-paintlet
								adams.gui.visualization.sequence.LinePaintlet
									-stroke-thickness
									1.5
									-markers-disabled
									true
									-paint-all
									true
					-overlay-paintlet
						adams.gui.visualization.sequence.CirclePaintlet
					-marker-paintlet
						adams.flow.sink.sequenceplotter.NoMarkers
					-error-paintlet
						adams.flow.sink.sequenceplotter.NoErrorPaintlet
					-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-overlay-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-title
					GeoNet: earthquake data
					-axis-x
						adams.gui.visualization.core.AxisPanelOptions
							-label
							timestamp
							-type
							DATETIME
							-tick-generator
								adams.gui.visualization.core.axis.FancyTickGenerator
							-width
							40
							-custom-format
							M/d HH:mm:ss
					-axis-y
						adams.gui.visualization.core.AxisPanelOptions
							-label
							amplitude
							-tick-generator
								adams.gui.visualization.core.axis.FancyTickGenerator
							-width
							80
							-custom-format
							0.0
					-plot-updater
						adams.flow.sink.sequenceplotter.SimplePlotUpdater
							-update-interval
							200
					-post-processor
						adams.flow.sink.sequenceplotter.AligningSequences
							-limit
							2000
	-actor
		adams.flow.standalone.SetVariable
			-var-name
			email_sent
			-var-value
			false
	-actor
		adams.flow.source.FileSupplier
			-file
			${CWD}/NZCRLZ_HHN10.txt
	-actor
		adams.flow.transformer.TextFileReader
			-reader
				adams.data.io.input.SingleStringTextReader
	-actor
		adams.flow.control.Tee
			-name
			extract data
			-tee
				adams.flow.control.Branch
					-branch
						adams.flow.control.Sequence
							-name
							timestamp
							-actor
								adams.flow.transformer.StringCut
									-field-delimiter
									 
							-actor
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.StringToDouble
							-actor
								adams.flow.transformer.SetVariable
									-var-name
									timestamp
							-actor
								adams.flow.transformer.Convert
									-name
									Convert-1
									-conversion
										adams.data.conversion.TimeToString
							-actor
								adams.flow.transformer.SetVariable
									-name
									SetVariable-1
									-var-name
									timestamp_str
					-branch
						adams.flow.control.Sequence
							-name
							amplitude
							-actor
								adams.flow.transformer.StringCut
									-field-delimiter
									 
									-field-index
									2
							-actor
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.StringToDouble
							-actor
								adams.flow.transformer.SetVariable
									-var-name
									amplitude
							-actor
								adams.flow.control.Tee
									-name
									email alert
									-tee
										adams.flow.control.IfThenElse
											-condition
												adams.flow.condition.bool.Expression
													-expression
													(abs(X) > 30000) & !@{email_sent}
											-then
												adams.flow.control.Sequence
													-name
													then
													-actor
														adams.flow.transformer.SetVariable
															-var-name
															email_sent
															-var-value
															true
													-actor
														adams.flow.control.Trigger
															-tee
																adams.flow.source.Start
															-tee
																adams.flow.sink.Email
																	-recipient
																	fracpete@gmail.com
																	-subject
																	earthquake alert
																	-body
																	Shake encountered!\n- amplitude: @{amplitude} \n- timestamp: @{timestamp_str}
																	-send-email
																		adams.core.net.JavaMailSendEmail
											-else
												adams.flow.control.Sequence
													-name
													else
	-actor
		adams.flow.control.Trigger
			-name
			plot data
			-tee
				adams.flow.source.Variable
					-var-name
					amplitude
			-tee
				adams.flow.control.Injector
					-injection
					@{timestamp}
					-location
					BEFORE
			-tee
				adams.flow.transformer.Convert
					-conversion
						adams.data.conversion.StringToDouble
			-tee
				adams.flow.transformer.SequenceToArray
					-length
					2
			-tee
				adams.flow.transformer.MakePlotContainer
			-tee
				adams.flow.sink.CallableSink
					-callable
					SequencePlotter
	-flow-execution-listener
		adams.flow.execution.NullListener

